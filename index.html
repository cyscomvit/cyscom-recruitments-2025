<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://www.gstatic.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://apis.google.com https://*.googleusercontent.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data: https: https://*.googleusercontent.com https://*.googleapis.com; connect-src 'self' https://*.googleapis.com https://*.firebaseio.com https://ipapi.co https://accounts.google.com https://oauth2.googleapis.com https://www.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com; font-src 'self' https://cdn.jsdelivr.net; frame-src 'self' https://accounts.google.com https://*.firebaseapp.com; child-src 'self' https://accounts.google.com;">
    
    <title>Cyscom Recuitments 2025</title>
    <link rel="shortcut icon" href="Images/logo.png" type="image/x-icon">
    <link rel="icon" href="Images/logo.png" type="image/png">
    <link rel="apple-touch-icon" href="Images/logo.png">
    
    

    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="Particles.css" as="style">

    <link rel="preload" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/locomotive-scroll@3.5.4/dist/locomotive-scroll.css" as="style">
    
    <link rel="preload" href="./Futura-Bold.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="preload" href="./HelveticaNowText-Regular.ttf" as="font" type="font/ttf" crossorigin>
    
    <link rel="preload" href="Images/Background.png" as="image">
    
    <link rel="preload" href="Images/logo.png" as="image">
    
    <link rel="preload" href="./video.webm" as="video" type="video/webm">
    

    <link rel="preload" href="Images/Tech.png" as="image">
    <link rel="preload" href="Images/Design.png" as="image">
    <link rel="preload" href="Images/dEV.png" as="image">
    <link rel="preload" href="Images/SM.png" as="image">
    <link rel="preload" href="Images/Content.png" as="image">
    <link rel="preload" href="Images/EM.png" as="image">
    
    <link rel="preload" href="Images/Eve1.png" as="image">
    <link rel="preload" href="Images/Eve2.png" as="image">
    <link rel="preload" href="Images/Eve3.png" as="image">
    <link rel="preload" href="Images/Eve4.png" as="image">
    
    <!-- 8. Preload Critical JavaScript Libraries -->
    <link rel="preload" href="https://unpkg.com/react@18/umd/react.production.min.js" as="script">
    <link rel="preload" href="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" as="script">
    <link rel="preload" href="https://unpkg.com/@babel/standalone/babel.min.js" as="script">
    
    <!-- 9. Preload Particles Script for Faster Loading -->
    <link rel="preload" href="SimpleParticles.js" as="script">
    
    <!-- 9. Preload Critical Local Scripts -->
    <link rel="preload" href="firebase-env.js" as="script">
    <link rel="preload" href="firebase-config.js" as="script">
    <link rel="preload" href="security-utils.js" as="script">
    <link rel="preload" href="app.js" as="script">
    
    <!-- 10. Preload Animation Libraries -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/locomotive-scroll@3.5.4/dist/locomotive-scroll.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" as="script">
    
    <!-- 11. Preload Additional Components -->
    <link rel="preload" href="glitch-text-component.js" as="script">
    <link rel="preload" href="tilted-card.js" as="script">
    
    <!-- Load Stylesheets (after preloading) -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="Particles.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/locomotive-scroll@3.5.4/dist/locomotive-scroll.css">
    
    <!-- DNS Prefetch for External Domains (Performance Optimization) -->
    <link rel="dns-prefetch" href="//unpkg.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//www.gstatic.com">
    <link rel="dns-prefetch" href="//apis.google.com">
    <link rel="dns-prefetch" href="//accounts.google.com">
    
    <!-- Preconnect to Critical External Services -->
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://apis.google.com" crossorigin>
    
    <!-- React and Babel CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- IMMEDIATE PARTICLES SCRIPT LOADING - Load particles ASAP after React -->
    <script>
        // Start particles initialization checks immediately
        if (window.React && window.ReactDOM) {
            console.log('Loading');
        }
    </script>
    
    <!-- Firebase Configuration (load environment first, then config) -->
    <script src="firebase-env.js"></script>
    <script src="firebase-config.js"></script>
    
    <!-- Security Utilities -->
    <script src="security-utils.js"></script>
    
    <!-- Maintenance mode styles: hide public form and sign-in on front page -->
    <style id="maintenance-hide-form">
        /* Hide the recruitment form and authentication prompts while keeping DOM present */
        #recruitment-form-container,
        #recruitment-form,
        #auth-overlay,
        #form-restriction-notice,
        #direct-google-sign-in-btn,
        #shortlist-notice,
        #user-info-bar,
        #google-sign-in-btn,
        .direct-google-auth-btn,
        .auth-container,
        .auth-card,
        #user-info-bar {
            display: none !important;
            visibility: hidden !important;
            pointer-events: none !important;
            opacity: 0 !important;
        }

        /* Keep the recruitment header visible (optional) - comment out to hide header too */
        #recruitment-header { display: block !important; visibility: visible !important; opacity: 1 !important; }
    </style>

</head>

<body>
    <div id="nav">
        <div id="nav-part1">
            <img src="Images/logo.png" alt="Logo" style="height: 80px;">
        </div>
        <div id="nav-part2">
            <div id="links">
                <a href="#page1" id="home-link">HOME</a>
                <a href="#moto" id="about-link">ABOUT</a>
                <a href="#page2" id="register-link">DEPARTMENTS</a>
                <a href="#page4" id="recruitment-link">RESULTS</a>
            </div>
        </div>
    </div>
    <div id="cursor"></div>
    <div id="main">
    <div id="page1">
            <!-- Particles Background -->
            <div id="particles-background" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;"></div>
            
            <div class="top-spacer"></div>
            <h1 class="main-title">CYSCOM</h1>
            <h1 class="main-title">RECRUITMENTS</h1>
            <h1 class="main-title">2025</h1>
            <div class="bottom-spacer"></div>
            <div id="video-container">
                <div id="play">PLAY</div>
                <video autoplay playsinline muted loop preload="auto" poster="Images/poster.png" src="./video.webm" style="display:block; margin:auto;"></video>
            </div>
        </div>
        <div id="page2">
            <div id="slider-container">
                <div id="slider-wrapper">
                    <!-- Original slides -->
                    <div id="elem1" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\Tech.png"
                            alt="" style="width:280px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #013066;">
                                <i class="ri-circle-fill"></i>
                                <p><b>TECHNICAL</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #06b1bd;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Dive into cybersecurity challenges, build tools, and sharpen your hacking skills while working on real-world security projects.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem2" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\Design.png"
                            alt="" style="width:420px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #0484ac;">
                                <i class="ri-circle-fill"></i>
                                <p><b>DESIGN</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #06b1bd;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Transform ideas into impactful visuals logos, posters, and graphics that define our brand identity.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem3" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\dEV.png"
                            alt="" style="width:250px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #040277;">
                                <i class="ri-circle-fill"></i>
                                <p><b>DEV</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #0484ac;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Craft and maintain sleek, secure, and functional web experiences for Cyscom’s events and platforms.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem4" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\SM.png"
                            alt="" style="width:320px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #2c4cb8;">
                                <i class="ri-circle-fill"></i>
                                <p><b>SOCIAL MEDIA</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #0484ac;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Shape Cyscom’s online presence with creative posts, trending content, and engaging campaigns.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem5" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\Content.png"
                            alt="" style="width:250px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #37288a;">
                                <i class="ri-circle-fill"></i>
                                <p><b>CONTENT</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #0484ac;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Research, write, and create compelling articles, blogs, and resources that spread cybersecurity awareness.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem6" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\EM.png"
                            alt="" style="width:250px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #3e0699;">
                                <i class="ri-circle-fill"></i>
                                <p><b>EVENT MANAGEMENT</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #0484ac;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Plan, coordinate, and execute engaging cybersecurity events, from CTFs to workshops, making each one unforgettable.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Complete duplicate set for seamless looping -->
                    <div id="elem1" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\Tech.png"
                            alt="" style="width:280px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #013066;">
                                <i class="ri-circle-fill"></i>
                                <p><b>TECHNICAL</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #06b1bd;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Dive into cybersecurity challenges, build tools, and sharpen your hacking skills while working on real-world security projects.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem2" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\Design.png"
                            alt="" style="width:420px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #0484ac;">
                                <i class="ri-circle-fill"></i>
                                <p><b>DESIGN</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #06b1bd;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Transform ideas into impactful visuals logos, posters, and graphics that define our brand identity</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem3" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\dEV.png"
                            alt="" style="width:250px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #040277;">
                                <i class="ri-circle-fill"></i>
                                <p><b>DEV</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #0484ac;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Craft and maintain sleek, secure, and functional web experiences for Cyscom’s events and platforms.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem4" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\SM.png"
                            alt="" style="width:320px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #2c4cb8;">
                                <i class="ri-circle-fill"></i>
                                <p><b>SOCIAL MEDIA</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #0484ac;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Shape Cyscom’s online presence with creative posts, trending content, and engaging campaigns</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem5" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\Content.png"
                            alt="" style="width:250px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #37288a;">
                                <i class="ri-circle-fill"></i>
                                <p><b>CONTENT</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #0484ac;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Research, write, and create compelling articles, blogs, and resources that spread cybersecurity awareness.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="elem6" class="elem">
                        <img data-scroll data-scroll-speed="1"
                            src="Images\EM.png"
                            alt="" style="width:250px; height:auto;">
                        <div data-scroll data-scroll-speed="-2" class="dets">
                            <div class="dets-info" style="background-color: #3e0699;">
                                <i class="ri-circle-fill"></i>
                                <p><b>EVENT MANAGEMENT</b></p>
                                <i class="ri-arrow-right-s-line"></i>
                            </div>
                            <div class="container" style="background-color: #0484ac;">
                                <div class="listing">
                                    <div class="list-elem">
                                        <p>Plan, coordinate, and execute engaging cybersecurity events, from CTFs to workshops, making each one unforgettable.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="moto">
            <h2>THE BEST CYBERSECUIRTY CLUB IN VIT CHENNAI.</h2>
            <div class="para">
                <p>The Cybersecurity Student Community (CYSCOM) was formed in 2022 and ever since it has had one aim only, spreading awareness about cyber security and malware as well as ransomware threats in society and circles of students and teaching them how to deploy counter measures through various events and undertakings</p>
            </div>
        </div>
        <div id="page3">
            <div class="child" id="child1" data-color="#D4D0D3">
                <img src="Images/Eve1.png"
                    alt="">
                <div class="childInfo">
                    <p>Hack Overflow</p>
                    <p>2022</p>
                </div>
            </div>
            <div class="child" id="child2" data-color="#E6DFD7">
                <img src="Images/Eve2.png"
                    alt="">
                <div class="childInfo">
                    <p>Code & Conquer</p>
                    <p>2024</p>
                </div>
            </div>
            <div class="child" id="child3" data-color="#E6DFD7">
                <img src="Images/Eve3.png"
                    alt="">
                <div class="childInfo">
                    <p>V-Medithon</p>
                    <p>2024</p>
                </div>
            </div>
            <div class="child" id="child4" data-color="#B4D5B6">
                <img src="Images/Eve4.png"
                    alt="">
                <div class="childInfo">
                    <p>Zypher CTF</p>
                    <p>2023</p>
                </div>
            </div>
        </div>
        <div id="page4">
            <!-- Authentication Overlay -->
            <div id="auth-overlay" style="display: none;">
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <i class="ri-shield-check-line"></i>
                            <h2>Sign In Required</h2>
                            <p>Please sign in with your Google account to access the application form</p>
                        </div>
                        
                        <div class="auth-content">
                            <button id="google-sign-in-btn" class="google-auth-btn">
                                <i class="ri-google-line"></i>
                                <span>Continue with Google</span>
                            </button>
                            
                            <div class="auth-info">
                                <p><i class="ri-information-line"></i> We use Google Sign-In to verify your identity and prevent spam applications.</p>
                                <p><i class="ri-lock-line"></i> Your information is secure and will only be used for the application process.</p>
                            </div>
                        </div>
                        
                        <button id="close-auth-overlay" class="close-auth-btn">
                            <i class="ri-close-line"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- User Info Bar (shown when authenticated) -->
            <div id="user-info-bar" style="display: none;">
                <div class="user-info-content">
                    <div class="user-details">
                        <img id="user-avatar" class="user-avatar-img" src="" alt="User Avatar">
                        <span>Signed in as <strong id="user-name"></strong></span>
                    </div>
                    <button id="sign-out-btn" class="sign-out-button">
                        <i class="ri-logout-box-line"></i>
                        Sign Out
                    </button>
                </div>
            </div>

            <div id="recruitment-section">
                <div id="recruitment-header">
                    <h2>RESULTS WILL BE ANNOUNCED SOON</h2>
                    <h3>Stay tuned!</h3>
                    <!-- <h4>PLEASE SELECT YOUR SLOT BEFORE 12TH SEPTEMBER 20:00 HRS</h4> -->
                    <p>Follow our socials to know when the results are announced.</p>
                </div>
                
                <!-- Recruitment Form -->
                <div id="recruitment-form-container">
                    <form id="recruitment-form" method="post" action="#" onsubmit="return false;" novalidate>
                        <!-- Interview Slot Selection (shortlisted candidates only) -->
                        <div class="form-section">
                            <h4>Select an Interview Time Slot</h4>
                            <p id="slot-instructions" style="color: #666; font-size: 0.95rem; margin-bottom: 12px;">As a shortlisted candidate, please choose one time slot for your interview. Submitting will update your entry in the shortlisted list.</p>
                            <p id="slot-summary" style="color: #ddd; font-size: 0.9rem; margin-bottom: 16px;">Loading slot availability...</p>

                            <div class="form-group">
                                <label for="timeSlot">Available Time Slots <span class="required">*</span></label>
                                <select style="color: white; background-color: #013066;" id="timeSlot" name="timeSlot" required>
                                    <option value="">-- Select a preferred slot --</option>
                                    <option value="2025-09-12_21:00-23:00">Sept 12, 2025 — 21:00–23:00</option>
                                    <option value="2025-09-13_10:00-12:30">Sept 13, 2025 — 10:00–12:30</option>
                                    <option value="2025-09-13_21:00-23:30">Sept 13, 2025 — 21:00-23:30</option>
                                    <option value="2025-09-14_10:00-12:30">Sept 14, 2025 — 10:00-12:30</option>
                                    <option value="2025-09-14_21:00-22:30">Sept 14, 2025 — 21:00-22:30</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="slotNote">Optional note (e.g., unavailability)</label>
                                <input type="text" style="color: white; background-color: #013066;" id="slotNote" name="slotNote" placeholder="Short note (optional)">
                            </div>
                        </div>

                        <!-- Honeypot for bots -->
                        <div style="position: absolute; left: -9999px; visibility: hidden;">
                            <input type="text" name="website" tabindex="-1" autocomplete="off" />
                        </div>

                        <div class="form-actions">
                            <button type="submit" id="submit-btn" class="submit-button">
                                <span class="btn-text">Submit Slot</span>
                                <span class="loading-spinner" style="display: none;">
                                    <i class="ri-loader-4-line"></i>
                                </span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Success/Error Messages -->
                <div id="form-messages" style="display: none;">
                    <div id="success-message" class="message success-msg" style="display: none;">
                        <p>Thank you for your interest in CYSCOM. We'll review your application and get back to you soon. Join the below WhatsApp group for updates.</p>
                    </div>
                    
                    <div id="error-message" class="message error-msg" style="display: none;">
                        <h4>Submission Failed</h4>
                        <p>There was an error submitting your application. Please try again.</p>
                    </div>
                </div>
            </div>
            <hr>
        </div>
        <div id="page5">
            <div id="footer">
                <div id="connect">
                    <p>CONNECT WITH US</p>
                    <a href="https://www.instagram.com/cyscomvit" title="Follow us on Instagram">
                        <i class="ri-instagram-line"></i>
                    </a>
                    <a href="https://x.com/CyscomVit" title="Follow us on X (Twitter)">
                        <i class="ri-twitter-x-line"></i>
                    </a>
                    <a href="https://www.linkedin.com/company/cyscomvit/" title="Connect with us on LinkedIn">
                        <i class="ri-linkedin-line"></i>
                    </a>
                </div>
                <div id="logo">
                    <img src="./logo.png" alt="">
                    <div id="copyright">
                        <a href="https://cyscomvit.com/">&copy; CYSCOM</a>
                        <a href="https://www.aicte.gov.in/">RECOGNIZED BY AICTE, Govt. Of INDIA</a>
                        <a href="https://chennai.vit.ac.in/">VIT CHENNAI</a>
                    </div>
                </div>
                <div id="nitty">
                    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
                    <a href="#"></a>
                    <a href="#"></a>
                    <a href="#"></a>
                    <a href="#"></a>
                    <a href="#"></a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/locomotive-scroll@3.5.4/dist/locomotive-scroll.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"
        integrity="sha512-16esztaSRplJROstbIIdwX3N97V1+pZvV33ABoG1H2OyTttBxEGkTsoIVsiP1iaTtM8b3+hu2kB6pQ4Clr5yug=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"
        integrity="sha512-Ic9xkERjyZ1xgJ5svx3y0u3xrvfT/uPkV99LBwe68xjy/mGtO+4eURHZBW2xW4SZbFrF1Tf090XqB+EVgXnVjw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="app.js"></script>
    <script type="text/babel" src="react-components.js"></script>
    <script type="text/babel" src="react-enhanced.js"></script>
    <script type="text/babel" src="animated-department-selector.js"></script>
    <script src="glitch-text-component.js"></script>
    <script type="text/babel" src="SimpleParticles.js"></script>
    <script>

        // Start trying to initialize particles as soon as DOM is ready
        let particlesInitialized = false;
        
        function initializeParticlesBackground() {
            if (particlesInitialized) return;
            
            const particlesContainer = document.getElementById('particles-background');
            

            if (!particlesContainer) {

                setTimeout(initializeParticlesBackground, 100);
                return;
            }
            
            if (!window.React || !window.ReactDOM) {

                setTimeout(initializeParticlesBackground, 100);
                return;
            }
            
            if (!window.Particles) {

                setTimeout(initializeParticlesBackground, 100);
                return;
            }

            try {
                // Create React element using createElement
                const particlesElement = React.createElement(window.Particles, {
                    particleCount: 50, 
                    speed: 0.4, 
                    particleColors: ['#ffffff', '#e0e6ff', '#b8c5ff', '#d4d9ff', '#00BFFF'],
                    size: 3,
                    className: 'page1-particles'
                });

                // Render to the particles container
                ReactDOM.render(particlesElement, particlesContainer);
                particlesInitialized = true;
                
            } catch (error) {
                console.error('Error initializing particles:', error);
                showParticlesFallback(particlesContainer);
            }
        }
        
        // Enhanced fallback with immediate animation
        function showParticlesFallback(container) {
            container.style.background = `
                radial-gradient(circle at 20% 30%, rgba(255,255,255,0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(224,230,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 60% 80%, rgba(184,197,255,0.08) 0%, transparent 50%),
                radial-gradient(circle at 30% 70%, rgba(212,217,255,0.12) 0%, transparent 50%)
            `;
            container.style.animation = 'particlesFallback 6s ease-in-out infinite alternate';
        }
        
        // Multiple initialization attempts for fastest possible loading
        document.addEventListener('DOMContentLoaded', function() {
            initializeParticlesBackground();
        });
        
        // Force page to top on refresh/load
        window.addEventListener('beforeunload', function() {
            window.scrollTo(0, 0);
        });
        
        // Also ensure we're at top when page loads and retry particles if needed
        window.addEventListener('load', function() {
            setTimeout(function() {
                window.scrollTo(0, 0);
            }, 100);
            
            // Final attempt after full page load
            if (!particlesInitialized) {
                initializeParticlesBackground();
            }
        });
        
        // AGGRESSIVE RETRY: Try particles initialization every 200ms until successful
        const maxRetries = 25; // 5 seconds maximum
        let retryCount = 0;
        
        const aggressiveRetry = setInterval(() => {
            if (particlesInitialized || retryCount >= maxRetries) {
                clearInterval(aggressiveRetry);
                if (retryCount >= maxRetries) {
                    const container = document.getElementById('particles-background');
                    if (container) showParticlesFallback(container);
                }
                return;
            }
            retryCount++;
            initializeParticlesBackground();
        }, 200);

        // Initialize Particles Background Function
        function initializeParticlesBackground() {
            const particlesContainer = document.getElementById('particles-background');
            
            // Check if all required dependencies are loaded
            if (!particlesContainer) {
                return;
            }
            
            if (!window.React || !window.ReactDOM) {
                setTimeout(initializeParticlesBackground, 500);
                return;
            }
            
            if (!window.Particles) {
                setTimeout(initializeParticlesBackground, 500);
                return;
            }

            try {
                // Create React element using createElement
                const particlesElement = React.createElement(window.Particles, {
                    particleCount: 80,
                    speed: 0.3,
                    particleColors: ['#ffffff', '#e0e6ff', '#b8c5ff', '#d4d9ff', '#00BFFF'],
                    size: 3,
                    className: 'page1-particles'
                });

                // Render to the particles container
                ReactDOM.render(particlesElement, particlesContainer);
                
            } catch (error) {
                console.error('Error initializing particles:', error);
                // Fallback: show a simple animated overlay
                particlesContainer.style.background = 'radial-gradient(circle at 30% 20%, rgba(255,255,255,0.1) 0%, transparent 50%), radial-gradient(circle at 70% 80%, rgba(255,255,255,0.05) 0%, transparent 50%)';
                particlesContainer.style.animation = 'pulse 4s ease-in-out infinite alternate';
            }
        }

        // Smooth scrolling for navigation links
        document.addEventListener('DOMContentLoaded', function() {
            // Force scroll to top immediately
            window.scrollTo(0, 0);
            
            // Initialize automatic glitch effect cycle for childInfo p tags
            function startGlitchCycle() {
                const children = [
                    { selector: '#child1 .childInfo p', delay: 0 },      // Start immediately
                    { selector: '#child2 .childInfo p', delay: 2000 },   // Start after 2 seconds
                    { selector: '#child3 .childInfo p', delay: 4000 },   // Start after 4 seconds
                    { selector: '#child4 .childInfo p', delay: 6000 }    // Start after 6 seconds
                ];
                
                children.forEach(child => {
                    setTimeout(() => {
                        const elements = document.querySelectorAll(child.selector);
                        
                        function glitchCycle() {
                            elements.forEach(el => el.classList.add('glitch-active'));
                            
                            // Remove glitch after 1 second
                            setTimeout(() => {
                                elements.forEach(el => el.classList.remove('glitch-active'));
                            }, 1000);
                        }
                        
                        // Start the glitch immediately
                        glitchCycle();
                        
                        // Repeat every 8 seconds (8s total cycle time)
                        setInterval(glitchCycle, 8000);
                        
                    }, child.delay);
                });
            }
            
            // Start the glitch cycle after a short delay to ensure DOM is ready
            setTimeout(startGlitchCycle, 500);
            
            // Get all navigation links
            const homeLink = document.getElementById('home-link');
            const aboutLink = document.getElementById('about-link');
            const registerLink = document.getElementById('register-link');
            const recruitmentLink = document.getElementById('recruitment-link');
            const resultsLink = document.getElementById('results-link');

            // Add smooth scroll behavior
            function smoothScrollTo(targetId) {
                const target = document.getElementById(targetId);
                console.debug('[smoothScrollTo] called for', targetId, 'userAgent=', navigator.userAgent, 'hasLocomotive=', !!window.locoScroll);
                if (target) {
                    // Check if it's a mobile device
                    if (/Mobi|Android/i.test(navigator.userAgent)) {
                        // On mobile, try a few methods to reliably scroll the page.
                        // 1) Prefer element.scrollIntoView which is often more reliable on mobile
                        // 2) Fall back to window.scrollTo using the element offsetTop adjusted for nav
                        // 3) Finally assign document.documentElement / body scrollTop if needed
                        console.debug('[smoothScrollTo] mobile path: attempting scrollIntoView for', targetId);
                        try {
                            target.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });
                        } catch (err) {
                            console.warn('[smoothScrollTo] scrollIntoView failed', err);
                        }

                        // Also attempt window.scrollTo with nav height compensation after a short delay
                        setTimeout(() => {
                            const nav = document.getElementById('nav');
                            const navHeight = nav ? nav.offsetHeight : 0;
                            const offset = Math.max(0, target.getBoundingClientRect().top + window.pageYOffset - navHeight - 8);
                            console.debug('[smoothScrollTo] mobile fallback: window.scrollTo to', offset, 'navHeight=', navHeight);
                            window.scrollTo({ top: offset, behavior: 'smooth' });

                            // No hard post-check or forced assignment — allow native smooth scroll to proceed
                        }, 60);

                        // Close mobile menu if it's open
                        const menu = document.querySelector('.nav-links');
                        if (menu && menu.classList.contains('active')) {
                            menu.classList.remove('active');
                        }
                    } else if (window.locoScroll) {
                        // On desktop, use Locomotive Scroll
                        console.debug('[smoothScrollTo] using locomotive scroll');
                        window.locoScroll.scrollTo(target);
                    } else {
                        // Fallback
                        console.debug('[smoothScrollTo] fallback: scrollIntoView');
                        target.scrollIntoView({
                            behavior: 'smooth',
                            inline: 'nearest'
                        });
                    }
                } else {
                    console.warn('[smoothScrollTo] target not found for', targetId);
                }
            }

            // Multiple methods for scrolling to top (for better compatibility)
            function scrollToTop() {
                // Method 1: window.scrollTo
                window.scrollTo({
                    top: 0,
                    left: 0,
                    behavior: 'smooth'
                });
                
                // Method 2: Fallback for older browsers
                document.body.scrollTop = 0;
                document.documentElement.scrollTop = 0;
            }

            // Add event listeners with null checks
            if (homeLink) {
                homeLink.addEventListener('click', function(e) {
                    console.debug('[nav] click on home-link', e.type, 'userAgent=', navigator.userAgent);
                    e.preventDefault();
                    scrollToTop();
                });
                // Touch fallback
                homeLink.addEventListener('touchstart', function(e) {
                    console.debug('[nav] touchstart on home-link', e.type, 'userAgent=', navigator.userAgent);
                    e.preventDefault();
                    scrollToTop();
                }, { passive: false });
            }

            if (aboutLink) {
                aboutLink.addEventListener('click', function(e) {
                    console.debug('[nav] click on about-link', e.type, 'userAgent=', navigator.userAgent);
                    e.preventDefault();
                    smoothScrollTo('moto');
                });
                // Touch fallback
                aboutLink.addEventListener('touchstart', function(e) {
                    console.debug('[nav] touchstart on about-link', e.type, 'userAgent=', navigator.userAgent);
                    e.preventDefault();
                    smoothScrollTo('moto');
                }, { passive: false });
            }

            if (registerLink) {
                registerLink.addEventListener('click', function(e) {
                    console.debug('[nav] click on register-link', e.type, 'userAgent=', navigator.userAgent);
                    e.preventDefault();
                    smoothScrollTo('page2');
                });
                // Touch fallback
                registerLink.addEventListener('touchstart', function(e) {
                    console.debug('[nav] touchstart on register-link', e.type, 'userAgent=', navigator.userAgent);
                    e.preventDefault();
                    smoothScrollTo('page2');
                }, { passive: false });
            }

            if (recruitmentLink) {
                recruitmentLink.addEventListener('click', function(e) {
                    console.debug('[nav] click on recruitment-link', e.type, 'userAgent=', navigator.userAgent);
                    e.preventDefault();
                    smoothScrollTo('page4');
                });
                // Touch fallback
                recruitmentLink.addEventListener('touchstart', function(e) {
                    console.debug('[nav] touchstart on recruitment-link', e.type, 'userAgent=', navigator.userAgent);
                    e.preventDefault();
                    smoothScrollTo('page4');
                }, { passive: false });
            }

            // Diagnostic helper: log pageYOffset for a short period after nav taps to detect if something else later moves it
            function logYOffsetFor(durationMs = 1000) {
                const start = Date.now();
                const id = setInterval(() => {
                    console.debug('[diagnostic] pageYOffset=', window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop);
                    if (Date.now() - start > durationMs) clearInterval(id);
                }, 150);
            }

            // Attach diagnostic logger to nav clicks/touches to help debugging
            [homeLink, aboutLink, registerLink, recruitmentLink].forEach(link => {
                if (!link) return;
                link.addEventListener('click', () => logYOffsetFor(1200));
                link.addEventListener('touchstart', () => logYOffsetFor(1200), { passive: true });
            });

            if (resultsLink) {
                resultsLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    smoothScrollTo('impact');
                });
            }

            // Navbar scroll behavior - integrated with Locomotive Scroll
            let lastScrollTop = 0;
            let scrollDirection = 'up';
            const nav = document.getElementById('nav');
            
            // Initialize nav as visible
            if (nav) {
                nav.classList.add('nav-visible');
            }

            // Wait for Locomotive Scroll to be initialized, then hook into it
            setTimeout(() => {
                if (window.locoScroll) {
                    // Hook into locomotive scroll events
                    window.locoScroll.on('scroll', (obj) => {
                        const currentScroll = obj.scroll.y;
                        
                        // Determine scroll direction
                        if (currentScroll > lastScrollTop && currentScroll > 50) {
                            // Scrolling down and past 50px threshold
                            scrollDirection = 'down';
                            if (nav) {
                                nav.classList.add('nav-hidden');
                                nav.classList.remove('nav-visible');
                            }
                        } else if (currentScroll < lastScrollTop) {
                            // Scrolling up - always show navbar
                            scrollDirection = 'up';
                            if (nav) {
                                nav.classList.add('nav-visible');
                                nav.classList.remove('nav-hidden');
                            }
                        }
                        
                        // Always show nav at the very top
                        if (currentScroll <= 20) {
                            if (nav) {
                                nav.classList.add('nav-visible');
                                nav.classList.remove('nav-hidden');
                            }
                        }
                        
                        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
                    });
                } else {
                    // Fallback to regular scroll if locomotive scroll is not available
                    console.warn('Locomotive Scroll not found, using fallback scroll behavior');
                    window.addEventListener('scroll', function() {
                        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                        
                        if (currentScroll > lastScrollTop && currentScroll > 50) {
                            scrollDirection = 'down';
                            if (nav) {
                                nav.classList.add('nav-hidden');
                                nav.classList.remove('nav-visible');
                            }
                        } else if (currentScroll < lastScrollTop) {
                            scrollDirection = 'up';
                            if (nav) {
                                nav.classList.add('nav-visible');
                                nav.classList.remove('nav-hidden');
                            }
                        }
                        
                        if (currentScroll <= 20) {
                            if (nav) {
                                nav.classList.add('nav-visible');
                                nav.classList.remove('nav-hidden');
                            }
                        }
                        
                        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
                    });
                }
            }, 1000); // Wait 1 second for locomotive scroll to initialize

            // Continuous Auto-Scrolling Infinite Slider
            const slider = document.getElementById('slider-wrapper');
            const slides = document.querySelectorAll('#page2 .elem');
            
            const slideWidth = 440; // 400px width + 40px margins
            const originalSlides = 6; // Number of original slides
            const totalSlides = slides.length; // Total including duplicates
            const scrollSpeed = 1.5; // Pixels per frame (adjust for speed)
            let currentPosition = 0;
            let animationId;
            let isPaused = false;


            // Continuous scrolling animation with perfect seamless loop
            function continuousScroll() {
                if (isPaused) {
                    animationId = requestAnimationFrame(continuousScroll);
                    return;
                }

                // Move position continuously
                currentPosition += scrollSpeed;
                
                // Apply transform
                slider.style.transform = `translateX(-${currentPosition}px)`;
                
                // Calculate when to reset to avoid any visible gap
                // Reset when we've scrolled exactly the width of original slides
                const resetThreshold = originalSlides * slideWidth;
                
                // Check if we need to reset (with a small buffer to prevent visual glitches)
                if (currentPosition >= resetThreshold - scrollSpeed) {
                    // Instant reset to create seamless loop
                    currentPosition = 0;
                    // Don't log every reset to avoid console spam
                    
                }
                
                // Continue animation
                animationId = requestAnimationFrame(continuousScroll);
            }

            // Start continuous scrolling
            function startContinuousScroll() {
                if (!animationId) {
                    
                    continuousScroll();
                }
            }

            // Stop continuous scrolling
            function stopContinuousScroll() {
                if (animationId) {
                    
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            }

            // Pause scrolling
            function pauseScroll() {
                
                isPaused = true;
            }

            // Resume scrolling
            function resumeScroll() {
                
                isPaused = false;
            }

            // Initialize slider with proper positioning
            function initializeSlider() {
                
                
                // Ensure no transition interferes
                slider.style.transition = 'none';
                
                // Start from the beginning
                currentPosition = 0;
                
                // Dynamically set the slider wrapper width
                const calculatedWidth = totalSlides * slideWidth;
                slider.style.width = `${calculatedWidth}px`;
                
                // Position the slider at the start
                slider.style.transform = `translateX(0px)`;
                
                
                
                // Verify we have enough duplicates by checking slide content
                const allSlides = slider.querySelectorAll('.elem');
                
                
                // Start continuous scrolling
                isPaused = false;
                startContinuousScroll();
            }

            // Pause on hover
            const sliderContainer = document.getElementById('slider-container');
            if (sliderContainer) {
                sliderContainer.addEventListener('mouseenter', pauseScroll);
                sliderContainer.addEventListener('mouseleave', resumeScroll);
            }

            // Pause on touch for mobile
            slider.addEventListener('touchstart', pauseScroll, { passive: true });
            slider.addEventListener('touchend', () => {
                setTimeout(resumeScroll, 1000); // Resume after 1 second
            }, { passive: true });

            // Handle page visibility (pause when tab is not active)
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    pauseScroll();
                } else {
                    resumeScroll();
                }
            });

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeSlider);
            } else {
                // Add a small delay to ensure all elements are rendered
                setTimeout(initializeSlider, 100);
            }

            // --- Glitch: make image/parent hover also trigger text glitch ---
            // This adds support for mouse hover and a JS touch fallback that toggles
            // a `.hovered` class on `.child` so the CSS rules can trigger the
            // `.glitch` pseudo-elements when the parent is hovered or tapped.
            (function setupChildHoverFallback() {
                const children = document.querySelectorAll('#page3 .child');
                if (!children || children.length === 0) return;

                children.forEach(child => {
                    // Mouse support: add/remove hovered class on enter/leave
                    child.addEventListener('mouseenter', () => child.classList.add('hovered'));
                    child.addEventListener('mouseleave', () => child.classList.remove('hovered'));

                    // Touch support: toggle on touchstart, remove on touchend or after a timeout
                    let touchTimer = null;
                    child.addEventListener('touchstart', (e) => {
                        // Prevent interfering with scroll - only proceed for short taps
                        child.classList.add('hovered');
                        if (touchTimer) clearTimeout(touchTimer);
                        touchTimer = setTimeout(() => {
                            child.classList.remove('hovered');
                            touchTimer = null;
                        }, 1200); // keep hovered for 1.2s
                    }, { passive: true });

                    child.addEventListener('touchend', () => {
                        if (touchTimer) {
                            clearTimeout(touchTimer);
                            touchTimer = null;
                        }
                        // remove hovered shortly after touchend to allow the effect to play
                        setTimeout(() => child.classList.remove('hovered'), 300);
                    }, { passive: true });
                });
            })();

            // Firebase Authentication for Form Access
            let currentUser = null;
            let isAuthChecking = true;

            // Initialize authentication when Firebase is loaded
            window.addEventListener('firebaseLoaded', initializeAuth);

            function initializeAuth() {
                
                
                // Check authentication state - persist sessions across refreshes
                window.firebase.onAuthStateChanged(window.firebase.auth, async (user) => {
                    console.log('Auth state changed:', {
                        user: !!user,
                        email: user?.email,
                        userAgent: navigator.userAgent.includes('Mobile') ? 'Mobile' : 'Desktop'
                    });
                    
                    currentUser = user;
                    isAuthChecking = false;
                    updateFormAccess(user);
                    
                    // If user is authenticated (including on page refresh), check for existing submission data
                    if (user && user.email) {
                        try {
                            console.log('Checking for existing submission data on auth state change...');
                            await checkExistingSubmission(user.email);
                        } catch (error) {
                            console.error('Error loading existing submission on auth state change:', error);
                            // Don't block the auth flow if this fails
                        }
                    }
                    
                    // Ensure mobile devices have proper auth state
                    if (user && navigator.userAgent.includes('Mobile')) {
                        setTimeout(() => {
                            if (!currentUser) {
                                console.log('Mobile auth recovery: Re-setting currentUser');
                                currentUser = window.firebase.auth.currentUser;
                            }
                        }, 1000);
                    }
                });

                // Setup auth event listeners
                setupAuthEventListeners();
                
                // Add a helper function for mobile compatibility
                window.getCurrentAuthUser = function() {
                    return currentUser || window.firebase.auth.currentUser;
                };
                
                // Mobile-specific auth state monitoring
                if (navigator.userAgent.includes('Mobile')) {
                    setInterval(() => {
                        const firebaseUser = window.firebase.auth.currentUser;
                        if (firebaseUser && !currentUser) {
                            console.log('Mobile auth recovery: Restoring currentUser from Firebase');
                            currentUser = firebaseUser;
                            updateFormAccess(firebaseUser);
                        }
                    }, 5000); // Check every 5 seconds
                }
            }

            function updateFormAccess(user) {
                const authOverlay = document.getElementById('auth-overlay');
                const userInfoBar = document.getElementById('user-info-bar');
                const recruitmentFormContainer = document.getElementById('recruitment-form-container');
                const formMessages = document.getElementById('form-messages');

                if (user) {
                    // User is signed in - show form, hide overlay and user info bar
                    
                    authOverlay.style.display = 'none';
                    userInfoBar.style.display = 'none'; // Hide user info bar for main page
                    
                    // Remove form restriction notice first
                    removeFormRestrictionNotice();
                    
                    // Remove the restricted class to show the form
                    recruitmentFormContainer.classList.remove('form-restricted');
                    
                    // Add a smooth appearance animation
                    recruitmentFormContainer.style.opacity = '0';
                    recruitmentFormContainer.style.transform = 'translateY(20px)';
                    recruitmentFormContainer.style.display = 'block';
                    
                    // Animate the form appearance
                    setTimeout(() => {
                        recruitmentFormContainer.style.transition = 'all 0.5s ease';
                        recruitmentFormContainer.style.opacity = '1';
                        recruitmentFormContainer.style.transform = 'translateY(0)';
                         if (window.updatePageScroll) {
                            setTimeout(window.updatePageScroll, 300);
                        }
                    }, 100);
                    
                    // Auto-fill and make email field immutable
                    const emailInput = document.getElementById('email');
                    if (emailInput) {
                        emailInput.value = user.email;
                        emailInput.readOnly = true;
                        emailInput.style.backgroundColor = '#f8f9fa';
                        emailInput.style.cursor = 'not-allowed';
                        emailInput.style.opacity = '0.8';
                        // Add a visual indicator that it's the authenticated email
                        emailInput.title = 'Email from authenticated Google account (read-only)';
                    }
                    
                    // Add or update user info section with sign-out button
                    addUserInfoSection(user);
                } else {
                    // User is not signed in - hide form, show restriction notice
                    
                    userInfoBar.style.display = 'none';
                    recruitmentFormContainer.classList.add('form-restricted');
                    
                    // Clear the current user document ID
                    window.currentUserDocId = null;
                    
                    // Remove user info section if it exists
                    removeUserInfoSection();
                    
                    // Reset submit button text
                    const submitBtn = document.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        const btnText = submitBtn.querySelector('.btn-text');
                        if (btnText) {
                            btnText.textContent = 'Submit Application';
                        }
                    }
                    
                    // Reset email field to editable
                    const emailInput = document.getElementById('email');
                    if (emailInput) {
                        emailInput.value = '';
                        emailInput.readOnly = false;
                        emailInput.style.backgroundColor = '';
                        emailInput.style.cursor = '';
                        emailInput.style.opacity = '';
                        emailInput.title = '';
                    }
                    
                    // Clear the form data when user signs out
                    resetFormData();
                    
                    // Add restriction notice if not already present
                    addFormRestrictionNotice();
                    if (window.updatePageScroll) {
                        setTimeout(window.updatePageScroll, 300);
                    }
                }
            }

            function resetFormData() {
                // Reset the recruitment form if it exists
                const recruitmentForm = document.getElementById('recruitment-form');
                if (recruitmentForm) {
                    recruitmentForm.reset();
                }
                
                // Reset department selections
                window.dispatchEvent(new CustomEvent('resetDepartmentSelector'));
                
                // Clear hidden department fields
                const primaryInput = document.getElementById('department-primary');
                const secondaryInput = document.getElementById('department-secondary');
                if (primaryInput) primaryInput.value = '';
                if (secondaryInput) secondaryInput.value = '';
            }

            function removeFormRestrictionNotice() {
                const existingNotice = document.getElementById('form-restriction-notice');
                if (existingNotice) {
                    existingNotice.remove();
                }
            }

            // Shortlist-specific notice helpers
            function addShortlistNotice() {
                const recruitmentSection = document.getElementById('recruitment-section');
                let existing = document.getElementById('shortlist-notice');
                if (existing) return;
                const notice = document.createElement('div');
                notice.id = 'shortlist-notice';
                notice.className = 'shortlist-notice';
                notice.innerHTML = `
                    <h3>Sorry but you were not shortlisted for the interview round</h3>
                    <p>If you have any queries, please contact the recruitment team via our WhatsApp group.</p>
                `;
                const formContainer = document.getElementById('recruitment-form-container');
                recruitmentSection.insertBefore(notice, formContainer);
            }

            function removeShortlistNotice() {
                const existing = document.getElementById('shortlist-notice');
                if (existing) existing.remove();
            }

            function addFormRestrictionNotice() {
                const recruitmentSection = document.getElementById('recruitment-section');
                let existingNotice = document.getElementById('form-restriction-notice');
                
                if (!existingNotice) {
                    const notice = document.createElement('div');
                    notice.id = 'form-restriction-notice';
                    notice.className = 'form-restriction-notice';
                    notice.innerHTML = `
                        <h3></h3>
                        <p>Please sign in with your VIT Student Google account (@vitstudent.ac.in) to access the application form</p>
                        <button id="direct-google-sign-in-btn" class="direct-google-auth-btn" style="
                            background: rgba(255,255,255,0.4);
                            color: white;
                            border: 1px solid rgba(255,255,255,0.3);
                            padding: 10px 20px;
                            border-radius: 8px;
                            cursor: pointer;
                            margin-top: 1rem;
                            display: inline-flex;
                            align-items: center;
                            gap: 8px;
                        ">
                            <i class="ri-google-line"></i>
                            <span>Continue with Google</span>
                        </button>
                    `;
                    
                    const formContainer = document.getElementById('recruitment-form-container');
                    recruitmentSection.insertBefore(notice, formContainer);
                    
                    // Setup event listener for the direct Google sign-in button
                    const directSignInBtn = document.getElementById('direct-google-sign-in-btn');
                    if (directSignInBtn) {
                        directSignInBtn.addEventListener('click', signInWithGoogle);
                    }
                }
            }

            function setupAuthEventListeners() {
                // Google Sign In button
                const googleSignInBtn = document.getElementById('google-sign-in-btn');
                if (googleSignInBtn) {
                    googleSignInBtn.addEventListener('click', signInWithGoogle);
                }

                // Sign Out buttons (handle multiple)
                const signOutBtns = document.querySelectorAll('.sign-out-btn, .sign-out-button, #sign-out-btn');
                signOutBtns.forEach(btn => {
                    if (btn) {
                        btn.addEventListener('click', signOutUser);
                    }
                });

                // Close auth overlay
                const closeAuthBtn = document.getElementById('close-auth-overlay');
                if (closeAuthBtn) {
                    closeAuthBtn.addEventListener('click', hideAuthOverlay);
                }

                // Close overlay when clicking outside
                const authOverlay = document.getElementById('auth-overlay');
                if (authOverlay) {
                    authOverlay.addEventListener('click', (e) => {
                        if (e.target === authOverlay) {
                            hideAuthOverlay();
                        }
                    });
                }

                // Intercept form interactions (with mobile auth compatibility)
                const recruitmentFormContainer = document.getElementById('recruitment-form-container');
                if (recruitmentFormContainer) {
                    recruitmentFormContainer.addEventListener('click', (e) => {
                        const authUser = currentUser || window.firebase?.auth?.currentUser;
                        if (!authUser && !isAuthChecking) {
                            e.preventDefault();
                            e.stopPropagation();
                            showAuthOverlay();
                        }
                    });
                    
                    recruitmentFormContainer.addEventListener('focusin', (e) => {
                        const authUser = currentUser || window.firebase?.auth?.currentUser;
                        if (!authUser && !isAuthChecking) {
                            e.preventDefault();
                            e.target.blur();
                            showAuthOverlay();
                        }
                    });
                }
            }

            async function signInWithGoogle() {
                try {
                    
                    const provider = new window.firebase.GoogleAuthProvider();
                    provider.setCustomParameters({
                        prompt: 'select_account'
                    });
                    
                    const result = await window.firebase.signInWithPopup(window.firebase.auth, provider);
                    const userEmail = result.user.email;
                    
                    
                    // Generate and log the document ID that will be used (deterministic SHA-256)
                    const expectedDocId = await hashEmail(userEmail);
                    
                    
                    // Check if email domain is allowed
                    if (!userEmail.endsWith('@vitstudent.ac.in')) {
                        console.warn('Unauthorized domain:', userEmail);
                        await window.firebase.signOut(window.firebase.auth);
                        showTemporaryMessage('Only VIT Student emails (@vitstudent.ac.in) are allowed to access this form.', 'error');
                        return;
                    }
                    
                    // Check for existing submission
                    await checkExistingSubmission(userEmail);
                    
                    // Show success message temporarily
                    showTemporaryMessage('Successfully signed in!', 'success');
                    
                } catch (error) {
                    console.error('Sign in error:', error);
                    let errorMessage = 'Sign in failed. Please try again.';
                    
                    if (error.code === 'auth/popup-closed-by-user') {
                        errorMessage = 'Sign in was cancelled. Please try again.';
                    } else if (error.code === 'auth/popup-blocked') {
                        errorMessage = 'Popup was blocked. Please allow popups and try again.';
                    }
                    
                    showTemporaryMessage(errorMessage, 'error');
                }
            }

            // Deterministic SHA-256 based ID derived from normalized email.
            // Uses the Web Crypto API so collisions are extremely unlikely and the
            // same email always produces the same ID. Returns a promise that
            // resolves to a string like `user_<hex>`.
            async function hashEmail(email) {
                try {
                    const normalized = String(email || '').trim().toLowerCase();
                    if (normalized.length === 0) return 'user_0';
                    const enc = new TextEncoder();
                    const data = enc.encode(normalized);
                    const hashBuffer = await (crypto.subtle || window.crypto.subtle).digest('SHA-256', data);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    const hex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                    return 'user_' + hex;
                } catch (err) {
                    // Fallback: deterministic simple hash if Web Crypto is not available
                    let h = 0;
                    for (let i = 0; i < email.length; i++) {
                        h = ((h << 5) - h) + email.charCodeAt(i);
                        h |= 0;
                    }
                    return 'user_' + Math.abs(h).toString();
                }
            }

            async function checkExistingSubmission(userEmail) {
                try {
                    
                    
                    // Generate consistent document ID from email hash
                    const docId = await hashEmail(userEmail);
                    
                    
                    // Store the document ID for later use
                    window.currentUserDocId = docId;
                    
                    // Try to get the document directly by ID from the 'shortlisted' collection
                    const docRef = window.firebase.doc(window.firebase.db, 'shortlisted', docId);
                    const docSnapshot = await window.firebase.getDoc(docRef);
                    
                    if (docSnapshot.exists()) {
                        // User has existing submission - load it for editing
                        const existingData = docSnapshot.data();
                        
                        
                        
                        // Populate form with existing data
                        populateFormWithExistingData(existingData);
                        
                        // Show edit message
                        showTemporaryMessage('Welcome back! Your previous submission has been loaded for editing.', 'info');
                        
                        // Change submit button text
                        const submitBtn = document.querySelector('button[type="submit"]');
                        if (submitBtn) {
                            const btnText = submitBtn.querySelector('.btn-text');
                            if (btnText) {
                                btnText.textContent = 'Confirm Slot';
                            }
                        // Show persistent WhatsApp contact for users with existing submissions
                        if (typeof window.showWhatsAppLink === 'function') {
                            window.showWhatsAppLink({ docId });
                        }
                        }
                    } else {
                        // User is not in the shortlisted list - block access and show notice
                        console.info('User not found in shortlisted:', userEmail);
                        // Ensure any previously-visible existing-data UI is cleared
                        removeFormRestrictionNotice();
                        removeShortlistNotice();

                        // Add a shortlist-specific notice and restrict the form
                        addShortlistNotice();
                        const recruitmentFormContainer = document.getElementById('recruitment-form-container');
                        if (recruitmentFormContainer) recruitmentFormContainer.classList.add('form-restricted');
                    }
                    
                } catch (error) {
                    console.error('Error checking existing submission:', error);
                    // Don't block sign-in if checking fails
                }
            }

            function populateFormWithExistingData(data) {
                try {
                    // Shortlist flow: populate interview slot and optional note if present
                    const timeSlotInput = document.getElementById('timeSlot');
                    if (timeSlotInput && data.interviewSlot) {
                        timeSlotInput.value = data.interviewSlot;
                    }

                    const slotNote = document.getElementById('slotNote');
                    if (slotNote && data.interviewNote) {
                        slotNote.value = data.interviewNote;
                    }

                    // Remove any shortlist-notice and ensure the form is visible
                    removeShortlistNotice();
                    const recruitmentFormContainer = document.getElementById('recruitment-form-container');
                    if (recruitmentFormContainer) recruitmentFormContainer.classList.remove('form-restricted');

                    // Determine user's preferred departments (try multiple possible field names)
                    let userDepartments = [];
                    try {
                        if (Array.isArray(data.preferredDepartments) && data.preferredDepartments.length > 0) {
                            userDepartments = data.preferredDepartments.map(d => String(d).trim().toLowerCase());
                        } else {
                            const p = data.departmentPrimary || data.department_primary || data.primaryDepartment || data.primary || null;
                            const s = data.departmentSecondary || data.department_secondary || data.secondaryDepartment || data.secondary || null;
                            if (p) userDepartments.push(String(p).trim().toLowerCase());
                            if (s) userDepartments.push(String(s).trim().toLowerCase());
                            // Also update immutable display for departments
                            if (typeof setUserDepartmentsDisplay === 'function') {
                                setUserDepartmentsDisplay(p, s);
                            }
                        }
                    } catch (e) {
                        userDepartments = [];
                    }

                    // Persist allowed departments globally so the filter is retained across actions
                    window.currentUserAllowedDepartments = (userDepartments.length ? userDepartments : null);

                    // Load slot counts and apply department filter so the UI only enables matching slots
                    if (typeof loadSlotCounts === 'function') {
                        setTimeout(() => loadSlotCounts(), 200); // call without args so it uses the persisted value
                    }
                    // If preferredDepartments array path used, still show display
                    if (!data.departmentPrimary && Array.isArray(data.preferredDepartments) && data.preferredDepartments.length > 0) {
                        const p = data.preferredDepartments[0] || null;
                        const s = data.preferredDepartments[1] || null;
                        if (typeof setUserDepartmentsDisplay === 'function') setUserDepartmentsDisplay(p, s);
                    }
                    
                    
                    
                } catch (error) {
                    console.error('Error populating form with existing data:', error);
                }
            }

            function updateDepartmentDisplay(department, type) {
                // This function would update the department selector display
                // Since the department selector is a React component, we need to trigger updates through events
                
                
                // Dispatch a custom event that the React component can listen to
                window.dispatchEvent(new CustomEvent('updateDepartmentSelection', {
                    detail: { department, type }
                }));
                
                // Also update the hidden form fields directly as backup
                setTimeout(() => {
                    if (type === 'primary') {
                        const primaryInput = document.getElementById('department-primary');
                        if (primaryInput) primaryInput.value = department;
                    } else if (type === 'secondary') {
                        const secondaryInput = document.getElementById('department-secondary');
                        if (secondaryInput) secondaryInput.value = department;
                    }
                }, 100);
            }

            function addUserInfoSection(user) {
                const recruitmentSection = document.getElementById('recruitment-section');
                let existingUserInfo = document.getElementById('authenticated-user-info');
                
                if (!existingUserInfo) {
                    const userInfo = document.createElement('div');
                    userInfo.id = 'authenticated-user-info';
                    userInfo.className = 'authenticated-user-info';
                    userInfo.innerHTML = `
                        <div class="user-details">
                            <i class="ri-user-line"></i>
                            <span class="user-email">${user.email}</span>
                            <span class="auth-status">Verified</span>
                        </div>
                        <div id="user-departments-display" style="margin-top:6px; font-size:0.8rem; color:#ccc; display:none;">
                            <span style="opacity:0.8;">Departments:</span>
                            <span class="dept-primary" style="font-weight:600; color:#fff;"></span>
                            <span class="dept-secondary" style="margin-left:4px; color:#bbb;"></span>
                        </div>
                        <button id="user-info-sign-out-btn" class="sign-out-btn">
                            <i class="ri-logout-box-line"></i>
                            <span>Sign Out</span>
                        </button>
                    `;
                    
                    const formContainer = document.getElementById('recruitment-form-container');
                    recruitmentSection.insertBefore(userInfo, formContainer);
                    
                    // Setup event listener for sign-out button
                    const signOutBtn = document.getElementById('user-info-sign-out-btn');
                    if (signOutBtn) {
                        signOutBtn.addEventListener('click', signOutUser);
                    }
                } else {
                    // Update existing user info
                    const userEmail = existingUserInfo.querySelector('.user-email');
                    if (userEmail) {
                        userEmail.textContent = user.email;
                    }
                }
            }

            // Helper to set department display (immutable info section)
            function setUserDepartmentsDisplay(primary, secondary) {
                const container = document.getElementById('user-departments-display');
                if (!container) return;
                const pSpan = container.querySelector('.dept-primary');
                const sSpan = container.querySelector('.dept-secondary');
                if (primary) {
                    pSpan.textContent = primary.toUpperCase();
                } else {
                    pSpan.textContent = '';
                }
                if (secondary && secondary !== primary) {
                    sSpan.textContent = `| ${secondary.toUpperCase()}`;
                } else {
                    sSpan.textContent = '';
                }
                if (primary || secondary) {
                    container.style.display = 'block';
                }
            }

            function removeUserInfoSection() {
                const existingUserInfo = document.getElementById('authenticated-user-info');
                if (existingUserInfo) {
                    existingUserInfo.remove();
                }
            }

            // Proper sign-out handler
            async function signOutUser() {
                try {
                    // Clear current user document ID
                    window.currentUserDocId = null;

                    // Sign out from Firebase if available
                    if (window.firebase && window.firebase.auth) {
                        await window.firebase.signOut(window.firebase.auth);
                    }

                    // Clear UI and form state
                    resetFormData();
                    removeUserInfoSection();
                    if (typeof window.hideWhatsAppLink === 'function') window.hideWhatsAppLink();

                    // Clear persisted auth (best-effort)
                    try { localStorage.removeItem('firebase-auth-user'); } catch(e){}
                    try { sessionStorage.removeItem('firebase-auth-user'); } catch(e){}

                    showTemporaryMessage('Successfully signed out!', 'success');

                    // Refresh slot list without department filter
                    if (typeof loadSlotCounts === 'function') setTimeout(() => loadSlotCounts(null), 200);
                } catch (error) {
                    console.error('Sign out error:', error);
                    showTemporaryMessage('Sign out failed. Please try again.', 'error');
                }
            }

            // Make auth functions globally accessible
            window.showAuthOverlay = function() {
                const authOverlay = document.getElementById('auth-overlay');
                if (authOverlay) {
                    // Scroll to top of page to ensure popup is visible
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // Show the overlay after a brief delay to allow scroll
                    setTimeout(() => {
                        authOverlay.style.display = 'flex';
                    }, 100);
                }
            }

            window.hideAuthOverlay = function() {
                const authOverlay = document.getElementById('auth-overlay');
                if (authOverlay) {
                    authOverlay.style.display = 'none';
                }
            }

            function showAuthOverlay() {
                window.showAuthOverlay();
            }

            function hideAuthOverlay() {
                window.hideAuthOverlay();
            }

            function showTemporaryMessage(message, type) {
                const messageDiv = document.createElement('div');
                let backgroundColor;
                let zIndex = 10001;

                switch(type) {
                    case 'success':
                        backgroundColor = '#28a745';
                        break;
                    case 'info':
                        backgroundColor = '#3498db';
                        zIndex = 20000; 
                        break;
                    case 'error':
                    default:
                        backgroundColor = '#dc3545';
                        break;
                }
                
                messageDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: ${zIndex};
                    animation: slideInRight 0.3s ease;
                    background: ${backgroundColor};
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                `;
                messageDiv.textContent = message;
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        document.body.removeChild(messageDiv);
                    }, 300);
                }, 3000);
            }

            // Initialize auth when Firebase is ready
            if (window.firebaseLoaded) {
                initializeAuth();
            }

            // Recruitment Form Handling
            const recruitmentForm = document.getElementById('recruitment-form');
            const submitBtn = document.getElementById('submit-btn');
            const btnText = document.querySelector('.btn-text');
            const loadingSpinner = document.querySelector('.loading-spinner');
            const formMessages = document.getElementById('form-messages');
            const successMessage = document.getElementById('success-message');
            const errorMessage = document.getElementById('error-message');

            // Form validation and security
            function sanitizeInput(str) {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            }

            function validateEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            function validatePhone(phone) {
                const phoneRegex = /^[+]?[\d\s()-]{10,15}$/;
                return phoneRegex.test(phone);
            }

            function validateRegNumber(regNumber) {
                // Basic validation for VIT registration number format
                const regRegex = /^[0-9]{2}[A-Z]{3}[0-9]{4}$/;
                return regRegex.test(regNumber.toUpperCase());
            }

            // Rate limiting
            let lastSubmissionTime = 0;
            const SUBMISSION_COOLDOWN = 30000; // 30 seconds

            // Department selection styling
            const departmentOptions = document.querySelectorAll('.department-option');
            departmentOptions.forEach(option => {
                const radio = option.querySelector('input[type="radio"]');
                radio.addEventListener('change', function() {
                    departmentOptions.forEach(opt => opt.classList.remove('selected'));
                    if (this.checked) {
                        option.classList.add('selected');
                    }
                });
            });

            // Form submission (attach handler only if element exists). When form is hidden in maintenance mode,
            // this prevents runtime errors from attempting to attach listeners to null.
            // recruitmentForm is declared earlier as: const recruitmentForm = document.getElementById('recruitment-form');
            if (typeof recruitmentForm !== 'undefined' && recruitmentForm && recruitmentForm.addEventListener) {
                recruitmentForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                e.stopPropagation();

                // Double-check: Prevent any default form submission
                if (e.defaultPrevented === false) {
                    e.preventDefault();
                    return false;
                }

                // Enhanced authentication check for mobile compatibility
                let authUser = currentUser || window.firebase.auth.currentUser;
                
                // Additional mobile auth check - try to refresh auth state
                if (!authUser && navigator.userAgent.includes('Mobile')) {
                    console.log('Mobile device detected with no auth user. Attempting auth refresh...');
                    try {
                        await new Promise((resolve) => {
                            const unsubscribe = window.firebase.onAuthStateChanged(window.firebase.auth, (user) => {
                                authUser = user;
                                if (user) {
                                    currentUser = user;
                                }
                                unsubscribe();
                                resolve();
                            });
                        });
                    } catch (error) {
                        console.error('Auth refresh failed:', error);
                    }
                }
                
                // Debug logging for mobile issues
                console.log('Form submission auth check:', {
                    currentUser: !!currentUser,
                    firebaseAuthUser: !!window.firebase.auth.currentUser,
                    authUser: !!authUser,
                    authUserEmail: authUser?.email,
                    authUserUID: authUser?.uid,
                    authUserEmailVerified: authUser?.emailVerified,
                    userAgent: navigator.userAgent.includes('Mobile') ? 'Mobile' : 'Desktop'
                });
                
                // Get and log the auth token for debugging mobile issues
                try {
                    if (authUser) {
                        const token = await authUser.getIdTokenResult();
                        console.log('Firebase Auth Token Claims:', {
                            email: token.claims.email,
                            email_verified: token.claims.email_verified,
                            auth_time: token.claims.auth_time,
                            provider: token.claims.firebase?.sign_in_provider
                        });
                    }
                } catch (tokenError) {
                    console.warn('Could not retrieve auth token for debugging:', tokenError);
                }
                
                if (!authUser) {
                    console.warn('Authentication failed on form submission. User might need to sign in again.');
                    showError('Authentication required. Please sign in and try again.');
                    showAuthOverlay();
                    return;
                }
                
                // Update currentUser if it was null but Firebase has a user (mobile fix)
                if (!currentUser && authUser) {
                    currentUser = authUser;
                    console.log('Mobile auth fix: Updated currentUser from Firebase auth state');
                }

                

                // Security: Rate limiting check
                const userIP = await generateIPHash();
                if (!window.securityManager.checkRateLimit(userIP)) {
                    showError('Too many submission attempts. Please wait before trying again.');
                    return;
                }

                // Rate limiting check (legacy)
                const currentTime = Date.now();
                if (currentTime - lastSubmissionTime < SUBMISSION_COOLDOWN) {
                    showError('Please wait 30 seconds before submitting another application.');
                    return;
                }

                // Show loading state
                showLoadingState(true);

                try {
                    // Wait for Firebase to be loaded
                    if (!window.firebaseLoaded) {
                        
                        await new Promise((resolve, reject) => {
                            const timeout = setTimeout(() => {
                                reject(new Error('Firebase loading timeout'));
                            }, 10000); // 10 second timeout
                            
                            window.addEventListener('firebaseLoaded', () => {
                                clearTimeout(timeout);
                                resolve();
                            });
                            
                            // Check if Firebase is already loaded
                            if (window.firebaseLoaded) {
                                clearTimeout(timeout);
                                resolve();
                            }
                        });
                    }
                    

                    // Get form data
                    const formData = new FormData(recruitmentForm);
                    const applicationData = {};

                    // Security: Check honeypot field (bot protection)
                    const honeypotValue = formData.get('website');
                    if (!window.securityManager.validateHoneypot(honeypotValue)) {
                        // Silent fail for bots
                        showLoadingState(false);
                        return;
                    }

                    // Sanitize and validate inputs using security manager
                    for (let [key, value] of formData.entries()) {
                        // Skip honeypot field
                        if (key === 'website') continue;
                        
                        if (typeof value === 'string') {
                            // Use security manager for sanitization
                            const sanitizationType = getSanitizationType(key);
                            applicationData[key] = window.securityManager.sanitizeInput(value.trim(), sanitizationType);
                        } else {
                            applicationData[key] = value;
                        }
                    }

                    // Basic form validation
                    const validationErrors = performBasicValidation(applicationData);
                    if (validationErrors.length > 0) {
                        // Special handling for department validation errors
                        const departmentErrors = validationErrors.filter(error => 
                            error.includes('department') || error.includes('preference') || error.includes('different')
                        );
                        
                        if (departmentErrors.length > 0) {
                            // Highlight the department section with CSS class
                            const deptSection = document.getElementById('animated-department-selector');
                            if (deptSection) {
                                deptSection.classList.add('validation-error');
                                
                                // Remove highlight after 6 seconds
                                setTimeout(() => {
                                    deptSection.classList.remove('validation-error');
                                }, 6000);
                            }
                            
                            // Scroll to department section
                            deptSection?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        
                        showError(validationErrors.join('<br>'));
                        return;
                    }

                    // Add metadata with security fingerprinting
                    applicationData.submissionTime = new Date().toISOString();
                    applicationData.timestamp = window.firebase?.serverTimestamp ? window.firebase.serverTimestamp() : new Date();
                    applicationData.userAgent = navigator.userAgent.substring(0, 200); // Limit length
                    applicationData.applicationId = window.securityManager.generateApplicationId();
                    applicationData.ipHash = await generateIPHash(); // Privacy-friendly IP tracking
                    applicationData.browserFingerprint = window.securityUtils.generateFingerprint();
                    applicationData.sessionToken = window.securityManager.sessionToken;
                    
                    // Add authenticated user information (using authUser for mobile compatibility)
                    applicationData.authenticatedUser = {
                        uid: authUser.uid,
                        email: authUser.email,
                        displayName: authUser.displayName,
                        photoURL: authUser.photoURL,
                        emailVerified: authUser.emailVerified,
                        authProvider: 'google.com',
                        signInTime: new Date().toISOString()
                    };
                    
                    
                    
                    // Submit to Firebase (if configured)
                    if (window.firebase && window.firebase.db) {
                        try {
                            // Use the consistent document ID based on the authenticated user's email
                            const docId = window.currentUserDocId || await hashEmail(applicationData.authenticatedUser.email);

                            // Create reference to shortlisted document and merge the selected slot
                            const docRef = window.firebase.doc(window.firebase.db, 'shortlisted', docId);
                            const existingDoc = await window.firebase.getDoc(docRef);
                            const isUpdate = existingDoc.exists();

                            // Log the operation
                            window.securityManager.logSecurityEvent(isUpdate ? 'SLOT_UPDATE_INITIATED' : 'SLOT_SUBMISSION_INITIATED', {
                                documentId: docId,
                                applicationId: applicationData.applicationId,
                                timeSlot: applicationData.timeSlot,
                                isUpdate: isUpdate
                            });

                            // Prepare data to merge into shortlisted document
                            const slotPayload = {
                                interviewSlot: applicationData.timeSlot,
                                interviewNote: applicationData.slotNote || null,
                                interviewSlotUpdatedAt: window.firebase.serverTimestamp ? window.firebase.serverTimestamp() : new Date().toISOString(),
                                interviewUpdatedBy: applicationData.authenticatedUser?.email || null
                            };

                            // Preflight availability check: block booking if selected slot has 0 seats remaining
                            try {
                                const preSlotId = applicationData.timeSlot;
                                const preSlotRef = window.firebase.doc(window.firebase.db, 'interviewSlots', preSlotId);
                                const preSlotSnap = await window.firebase.getDoc(preSlotRef);
                                if (!preSlotSnap.exists()) {
                                    throw new Error('Selected slot does not exist');
                                }
                                const preRemaining = Number(preSlotSnap.data().remainingSeats || 0);
                                const currentBookedSlot = isUpdate ? (existingDoc.data().interviewSlot || null) : null;
                                const reconfirmingSame = currentBookedSlot && currentBookedSlot === preSlotId;
                                if (preRemaining <= 0 && !reconfirmingSame) {
                                    showError('Selected slot is full. Please choose another slot.');
                                    if (typeof loadSlotCounts === 'function') await loadSlotCounts();
                                    return;
                                }
                            } catch (preErr) {
                                // Surface preflight errors early
                                throw preErr;
                            }

                            // Attempt an atomic transaction to reserve the slot and update shortlisted doc
                            if (typeof window.firebase.runTransaction === 'function') {
                                await window.firebase.runTransaction(window.firebase.db, async (tx) => {
                                    const slotId = applicationData.timeSlot;
                                    const slotRef = window.firebase.doc(window.firebase.db, 'interviewSlots', slotId);
                                    const slotSnap = await tx.get(slotRef);

                                    if (!slotSnap.exists()) {
                                        throw new Error('Selected slot does not exist');
                                    }

                                    const slotData = slotSnap.data();
                                    const remaining = Number(slotData.remainingSeats || 0);

                                    // Get current shortlisted document within the same transaction
                                    const shortlistRef = docRef;
                                    const shortlistSnap = await tx.get(shortlistRef);
                                    const currentSlot = shortlistSnap.exists() ? shortlistSnap.data().interviewSlot : null;

                                    // If changing slots, ensure target has availability; if re-confirming same slot, allow updating note
                                    if (currentSlot === slotId) {
                                        // Only update the shortlisted doc (note/timestamps)
                                        if (shortlistSnap.exists()) {
                                            tx.update(shortlistRef, slotPayload);
                                        } else {
                                            tx.set(shortlistRef, slotPayload);
                                        }
                                        return;
                                    }

                                    if (remaining <= 0) {
                                        throw new Error('No seats remaining for the selected slot');
                                    }

                                    // Decrement target slot
                                    tx.update(slotRef, { remainingSeats: remaining - 1 });

                                    // If user had a previous slot, increment its counter
                                    if (currentSlot) {
                                        const prevRef = window.firebase.doc(window.firebase.db, 'interviewSlots', currentSlot);
                                        const prevSnap = await tx.get(prevRef);
                                        if (prevSnap.exists()) {
                                            const prevRem = Number(prevSnap.data().remainingSeats || 0);
                                            tx.update(prevRef, { remainingSeats: prevRem + 1 });
                                        }
                                    }

                                    // Update shortlisted doc with the new slot info
                                    if (shortlistSnap.exists()) {
                                        tx.update(shortlistRef, slotPayload);
                                    } else {
                                        tx.set(shortlistRef, slotPayload);
                                    }
                                });

                                // Refresh local slot counts UI after successful transaction
                                if (typeof loadSlotCounts === 'function') await loadSlotCounts();

                                // Store the document ID for future use
                                window.currentUserDocId = docId;

                                // Log successful submission
                                window.securityManager.logSecurityEvent(isUpdate ? 'FORM_UPDATE_SUCCESS' : 'FORM_SUBMISSION_SUCCESS', {
                                    documentId: docId,
                                    applicationId: applicationData.applicationId,
                                    timeSlot: applicationData.timeSlot,
                                    isUpdate: isUpdate
                                });

                                // Show success message
                                showSuccess(isUpdate);

                                // Update submit button text for future submissions
                                const submitBtn = document.querySelector('button[type="submit"]');
                                if (submitBtn) {
                                    const btnText = submitBtn.querySelector('.btn-text');
                                    if (btnText) {
                                        btnText.textContent = 'Confirm Slot';
                                    }
                                }

                                // Show persistent WhatsApp contact after successful submission/update
                                if (typeof window.showWhatsAppLink === 'function') {
                                    window.showWhatsAppLink({ docId });
                                }

                                // Update rate limiting
                                lastSubmissionTime = currentTime;

                                return; // Success complete
                            } else {
                                // Fallback: if runTransaction is not available, perform a best-effort update
                                // Attempt to decrement the target slot and increment the previous slot (if any)
                                try {
                                    const slotId = applicationData.timeSlot;
                                    const slotRef = window.firebase.doc(window.firebase.db, 'interviewSlots', slotId);
                                    const slotSnap = await window.firebase.getDoc(slotRef);

                                    if (!slotSnap.exists()) {
                                        throw new Error('Selected slot does not exist');
                                    }

                                    const slotData = slotSnap.data();
                                    const remaining = Number(slotData.remainingSeats || 0);

                                    // Read current shortlisted doc to determine previous slot
                                    const shortlistSnap = await window.firebase.getDoc(docRef);
                                    const currentSlot = shortlistSnap.exists() ? shortlistSnap.data().interviewSlot : null;

                                    if (currentSlot === slotId) {
                                        // Re-confirming same slot: only update shortlisted doc
                                        await window.firebase.setDoc(docRef, slotPayload, { merge: true });
                                    } else {
                                        if (remaining <= 0) {
                                            throw new Error('No seats remaining for the selected slot');
                                        }

                                        // Decrement target slot (best-effort)
                                        if (typeof window.firebase.updateDoc === 'function') {
                                            await window.firebase.updateDoc(slotRef, { remainingSeats: remaining - 1 });
                                        } else {
                                            // Fallback to set with merged value
                                            await window.firebase.setDoc(slotRef, { remainingSeats: remaining - 1 }, { merge: true });
                                        }

                                        // If user had a previous slot, increment its counter (best-effort)
                                        if (currentSlot) {
                                            const prevRef = window.firebase.doc(window.firebase.db, 'interviewSlots', currentSlot);
                                            const prevSnap = await window.firebase.getDoc(prevRef);
                                            if (prevSnap.exists()) {
                                                const prevRem = Number(prevSnap.data().remainingSeats || 0);
                                                if (typeof window.firebase.updateDoc === 'function') {
                                                    await window.firebase.updateDoc(prevRef, { remainingSeats: prevRem + 1 });
                                                } else {
                                                    await window.firebase.setDoc(prevRef, { remainingSeats: prevRem + 1 }, { merge: true });
                                                }
                                            }
                                        }

                                        // Update shortlisted doc with the new slot info
                                        await window.firebase.setDoc(docRef, slotPayload, { merge: true });
                                    }

                                    window.currentUserDocId = docId;
                                    window.securityManager.logSecurityEvent('FORM_SUBMISSION_SUCCESS_NO_TX', { documentId: docId, applicationId: applicationData.applicationId });
                                    showSuccess(isUpdate);
                                    if (typeof loadSlotCounts === 'function') await loadSlotCounts();
                                    lastSubmissionTime = currentTime;
                                    return;
                                } catch (fallbackErr) {
                                    // Re-throw to be handled by outer catch which already maps errors to user messages
                                    throw fallbackErr;
                                }
                            }
                            
                        } catch (firebaseError) {
                            console.error('Firebase submission error:', firebaseError);
                            
                            
                            // Log failed submission
                            window.securityManager.logSecurityEvent('FORM_SUBMISSION_FAILED', {
                                errorCode: firebaseError.code,
                                errorMessage: firebaseError.message
                            });
                            
                            // Show specific Firebase error or fallback to generic message
                            const msg = (firebaseError && firebaseError.message) ? String(firebaseError.message).toLowerCase() : '';
                            if (msg.includes('no seats remaining') || msg.includes('no seats') || msg.includes('no seats remaining for the selected slot') ) {
                                showError('Selected slot is full. Please choose another slot.');
                                // refresh counts
                                if (typeof loadSlotCounts === 'function') loadSlotCounts();
                            } else if (msg.includes('selected slot does not exist') || msg.includes('slot does not exist')) {
                                showError('Selected slot not found. Please refresh and try again.');
                                if (typeof loadSlotCounts === 'function') loadSlotCounts();
                            } else if (firebaseError.code === 'permission-denied') {
                                showError('Permission denied. Please check Firestore security rules.');
                            } else if (firebaseError.code === 'unavailable') {
                                showError('Firebase service unavailable. Please try again later.');
                            } else {
                                showError(`Firebase error: ${firebaseError.message}`);
                            }
                            return;
                        }
                    } else {
                        // Enhanced fallback logging
                        console.warn('Firebase not configured properly!');
                        
                        
                        showError('Firebase not configured. Please check the console for more details.');
                        return;
                    }

                } catch (error) {
                    console.error('Application submission error:', error);
                    
                    // Log error
                    window.securityManager.logSecurityEvent('FORM_SUBMISSION_ERROR', {
                        errorMessage: error.message,
                        errorStack: error.stack
                    });
                    
                    showError(`An unexpected error occurred: ${error.message}`);
                } finally {
                    showLoadingState(false);
                }
            });

            // Helper function to determine sanitization type
            function getSanitizationType(fieldName) {
                switch (fieldName) {
                    case 'timeSlot':
                        return 'default';
                    case 'slotNote':
                        return 'text';
                    default:
                        return 'default';
                }
            }

            // Enhanced validation function using security manager (now only validates time slot)
            function performBasicValidation(applicationData) {
                const errors = [];

                // Only the interview time slot is required
                if (!applicationData.timeSlot || String(applicationData.timeSlot).trim() === '') {
                    errors.push('Please select an interview time slot');
                }

                // Optionally ensure slotNote is reasonably short
                if (applicationData.slotNote && String(applicationData.slotNote).length > 300) {
                    errors.push('Optional note is too long (max 300 characters)');
                }

                return errors;
            }

            function generateApplicationId() {
                return 'APP_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9).toUpperCase();
            }

            // Load slot counts from 'interviewSlots' collection and update the select UI
            async function loadSlotCounts(allowedDepartments = null) {
                try {
                    if (!window.firebase || !window.firebase.db) return;
                    const select = document.getElementById('timeSlot');
                    if (!select) return;

                    // Get all slots documents
                    const slotsCol = window.firebase.collection(window.firebase.db, 'interviewSlots');
                    const snap = await window.firebase.getDocs(slotsCol);
                    const slotMap = {};
                    snap.forEach(doc => {
                        const data = doc.data();
                        slotMap[doc.id] = {
                            remaining: Number(data.remainingSeats || 0),
                            label: data.label || doc.id
                        };
                    });

                    // If no explicit allowedDepartments passed, use persisted global so filter persists
                    if ((!Array.isArray(allowedDepartments) || allowedDepartments.length === 0) && Array.isArray(window.currentUserAllowedDepartments)) {
                        allowedDepartments = window.currentUserAllowedDepartments;
                    }

                   const deptComboToSlots = {
                    'dev+technical': [
                        '2025-09-12_21:00-23:00',
                        '2025-09-13_10:00-12:30',
                        '2025-09-13_21:00-23:30',
                        '2025-09-14_10:00-12:30',
                        '2025-09-14_21:00-22:30'
                    ],

                    'event-management+technical': [
                        '2025-09-12_21:00-23:00',
                        '2025-09-13_21:00-23:30',
                        '2025-09-14_21:00-22:30'
                    ],

                    'content+dev': [
                        '2025-09-12_21:00-23:00',
                        '2025-09-14_21:00-22:30'
                    ],

                    'dev+social-media': [
                        '2025-09-12_21:00-23:00',
                        '2025-09-14_21:00-22:30'
                    ],

                    'content+social-media': [
                        '2025-09-12_21:00-23:00',
                        '2025-09-14_21:00-22:30'
                    ],

                    'design+dev': [
                        '2025-09-14_21:00-22:30'
                    ],

                    'design+event-management': [
                        '2025-09-14_21:00-22:30'
                    ],

                    'content+design': [
                        '2025-09-14_21:00-22:30',
                        '2025-09-13_10:00-12:30'
                    ],

                    'content+event-management': [
                        '2025-09-14_21:00-22:30'
                    ],

                    'dev+event-management': [
                        '2025-09-14_10:00-12:30',
                        '2025-09-14_21:00-22:30'
                    ],

                    'event-management+social-media': [
                        '2025-09-14_10:00-12:30',
                        '2025-09-14_21:00-22:30'
                    ],

                    'design+technical': [
                        '2025-09-14_10:00-12:30',
                        '2025-09-14_21:00-22:30'
                    ],

                    'content+technical': [
                        '2025-09-14_10:00-12:30',
                        '2025-09-14_21:00-22:30'
                    ],

                    'design+social-media': [
                        '2025-09-13_10:00-12:30',
                        '2025-09-14_21:00-22:30'
                    ],

                    'technical+social-media': [
                        '2025-09-13_21:00-23:30',
                        '2025-09-14_21:00-22:30'
                    ]
                };

                    // Compute allowedSlotIds from allowedDepartments (if provided)
                    let allowedSlotIds = null; // null => all enabled
                    let usingOverflowFallback = false;
                    const FALLBACK_SLOT_ID = '2025-09-14_22:30-23:30';
                    if (Array.isArray(allowedDepartments) && allowedDepartments.length > 0) {
                        // normalize and sort department names
                        const normalized = allowedDepartments.map(d => String(d).trim().toLowerCase().replace(/\s+/g, '')).sort().join('+');
                        if (deptComboToSlots[normalized]) {
                            const primaryAllowed = deptComboToSlots[normalized];
                            allowedSlotIds = primaryAllowed.slice();
                            // If all primary allowed slots are full (0 remaining), enable a special overflow slot just for this combo
                            const allPrimaryFull = primaryAllowed.length > 0 && primaryAllowed.every(id => (slotMap[id]?.remaining || 0) <= 0);
                            if (allPrimaryFull) {
                                usingOverflowFallback = true;
                                if (!allowedSlotIds.includes(FALLBACK_SLOT_ID)) {
                                    allowedSlotIds.push(FALLBACK_SLOT_ID);
                                }
                            }
                        } else {
                            // Unknown combination: for now, leave all options enabled
                            allowedSlotIds = null;
                        }
                    }

                    // Ensure the fallback slot option exists only when using overflow fallback
                    const existingFallbackOpt = Array.from(select.options).find(o => o.value === FALLBACK_SLOT_ID);
                    if (usingOverflowFallback && slotMap[FALLBACK_SLOT_ID]) {
                        if (!existingFallbackOpt) {
                            const newOpt = document.createElement('option');
                            newOpt.value = FALLBACK_SLOT_ID;
                            newOpt.textContent = `${slotMap[FALLBACK_SLOT_ID].label} (${slotMap[FALLBACK_SLOT_ID].remaining} seats remain)`;
                            newOpt.setAttribute('data-dynamic-fallback', 'true');
                            select.appendChild(newOpt);
                        }
                    } else {
                        // Remove dynamically added fallback option if present and not in use
                        if (existingFallbackOpt && existingFallbackOpt.getAttribute('data-dynamic-fallback') === 'true') {
                            existingFallbackOpt.remove();
                        }
                    }

                    // Update each option's text to include remaining seats and enable/disable based on mapping
                    const currentSelectedSlot = select.value || null;
                    for (let i = 0; i < select.options.length; i++) {
                        const opt = select.options[i];
                        const id = opt.value;
                        if (!id) continue;
                        const info = slotMap[id];
                        if (info) {
                            const baseEnabled = (allowedSlotIds === null) ? true : allowedSlotIds.includes(id);
                            // If slot is full (0 remaining), disable it unless it's the user's currently selected slot
                            const isFull = (info.remaining <= 0);
                            const enabled = baseEnabled && (!isFull || id === currentSelectedSlot);

                            // Label with FULL badge when 0 remaining
                            const labelSuffix = isFull ? ' — FULL' : ` (${info.remaining} seats remain)`;
                            opt.textContent = `${info.label}${isFull ? labelSuffix : ` (${info.remaining} seats remain)`}`;

                            opt.disabled = !enabled;
                            opt.style.opacity = enabled ? '1' : '0.45';

                            // Tooltip logic
                            if (enabled && id === FALLBACK_SLOT_ID && usingOverflowFallback) {
                                opt.title = 'Overflow availability (primary slots are full)';
                            } else if (isFull && id !== currentSelectedSlot) {
                                opt.title = 'Slot is FULL';
                            } else if (baseEnabled) {
                                opt.title = info.remaining + ' seats remain';
                            } else {
                                opt.title = 'Not available for your selected departments';
                            }
                        } else {
                            opt.disabled = true;
                            opt.style.opacity = '0.45';
                            opt.title = 'Slot not available';
                        }
                    }

                    // Update summary paragraph with concise availability
                    const summary = document.getElementById('slot-summary');
                    if (summary) {
                        const parts = Object.keys(slotMap).map(k => {
                            const s = slotMap[k];
                            return `${s.label}: ${s.remaining}${s.remaining <= 0 ? ' (FULL)' : ''}`;
                        });
                        summary.textContent = 'Slots remaining : ' + parts.join(' || ');
                    }
                } catch (err) {
                    console.error('Failed to load slot counts:', err);
                }
            }

            // Initial load of slot counts when Firebase is ready
            window.addEventListener('firebaseLoaded', () => {
                setTimeout(() => {
                    if (typeof loadSlotCounts === 'function') loadSlotCounts();
                }, 200);
            });

            // Generate privacy-friendly IP hash
            async function generateIPHash() {
                try {
                    // Get approximate location without exact IP
                    const response = await fetch('https://ipapi.co/json/');
                    const data = await response.json();
                    const locationString = `${data.country_code || 'XX'}_${data.region_code || 'XX'}`;
                    
                    // Create a simple hash
                    let hash = 0;
                    for (let i = 0; i < locationString.length; i++) {
                        const char = locationString.charCodeAt(i);
                        hash = ((hash << 5) - hash) + char;
                        hash = hash & hash; // Convert to 32-bit integer
                    }
                    return hash.toString(36);
                } catch {
                    return 'unknown';
                }
            }

            // Generate browser fingerprint for security
            function generateBrowserFingerprint() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('Security check', 2, 2);
                
                return {
                    screen: `${screen.width}x${screen.height}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    language: navigator.language,
                    platform: navigator.platform.substring(0, 20), // Limit length
                    canvas: canvas.toDataURL().substring(0, 50), // Limit length
                    timestamp: Date.now()
                };
            }

            function showLoadingState(loading) {
                if (loading) {
                    submitBtn.disabled = true;
                    btnText.style.display = 'none';
                    loadingSpinner.style.display = 'inline-block';
                    submitBtn.style.opacity = '0.7';
                } else {
                    submitBtn.disabled = false;
                    btnText.style.display = 'inline-block';
                    loadingSpinner.style.display = 'none';
                    submitBtn.style.opacity = '1';
                }
            }

            function showSuccess(isUpdate = false) {
                formMessages.style.display = 'block';
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                
                // Update success message based on whether it's a new submission or update
                const messageElement = successMessage.querySelector('h3') || successMessage.querySelector('p') || successMessage;
                if (isUpdate) {
                    messageElement.innerHTML = `
                        <h3>Slot Booked Successfully!</h3>
                        <p>Exact timings for your interview would be shared on the Whatsapp group</p>
                    `;
                } else {
                    messageElement.innerHTML = `
                        <h3>Slot Booked Successfully!</h3>
                        <p>Exact timings for your interview would be shared on the Whatsapp group</p>
                    `;
                }
                
                // Scroll to message
                formMessages.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Hide after 7 seconds (longer to read the message)
                setTimeout(() => {
                    formMessages.style.display = 'none';
                    successMessage.style.display = 'none';
                }, 7000);
            }

            // --- WhatsApp link support for users who have submitted or updated ---
            // Assumption: default contact number is set here; admins can override
            // by setting window.WHATSAPP_NUMBER (international format without '+', e.g. '919876543210').
            (function setupWhatsAppLink() {
                // Default WhatsApp group invite link; override by setting window.WHATSAPP_GROUP_LINK
                const DEFAULT_GROUP_LINK = 'https://chat.whatsapp.com/GEgOUx5s0t3AxYWTEItzEu?mode=ac_t';

                function ensureElement() {
                    if (document.getElementById('whatsapp-link-container')) return document.getElementById('whatsapp-link-container');

                    const container = document.createElement('div');
                    container.id = 'whatsapp-link-container';
                    container.setAttribute('aria-hidden', 'false');
                    // Minimal inline styling to keep it visible at the bottom of the recruitment section
                    container.style.cssText = 'margin-top:16px; display:none; width:100%; text-align:center; position:relative; z-index:1000;';

                    const link = document.createElement('a');
                    link.id = 'whatsapp-link';
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    link.style.cssText = 'display:inline-flex; align-items:center; gap:8px; background:#25D366; color:#ffffff; padding:10px 16px; border-radius:28px; text-decoration:none; font-weight:600; box-shadow:0 6px 18px rgba(37,211,102,0.18);';
                    link.title = 'Results will be announced here';
                    link.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/1022px-WhatsApp.svg.png" alt="WhatsApp" style="width:20px; height:20px; object-fit:contain;">JOIN FOR UPDATES';

                    container.appendChild(link);

                    // Place the container after the form messages (bottom of form area)
                    const recruitmentSection = document.getElementById('recruitment-section');
                    if (recruitmentSection) {
                        recruitmentSection.appendChild(container);
                    } else {
                        document.body.appendChild(container);
                    }

                    return container;
                }

                window.showWhatsAppLink = function (opts = {}) {
                    try {
                        const container = ensureElement();
                        const link = document.getElementById('whatsapp-link');
                        if (!link) return;

                        const groupLink = (window.WHATSAPP_GROUP_LINK && String(window.WHATSAPP_GROUP_LINK).trim()) || DEFAULT_GROUP_LINK;
                        link.href = groupLink;

                        container.style.display = 'block';
                    } catch (err) {
                        console.error('showWhatsAppLink error', err);
                    }
                };

                window.hideWhatsAppLink = function () {
                    const container = document.getElementById('whatsapp-link-container');
                    if (container) container.style.display = 'none';
                };
            })();

            function showError(message) {
                formMessages.style.display = 'block';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                errorMessage.querySelector('p').innerHTML = message;
                
                // Scroll to message
                formMessages.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Hide after 5 seconds
                setTimeout(() => {
                    formMessages.style.display = 'none';
                    errorMessage.style.display = 'none';
                }, 5000);
            }

            // Security: Disable right-click on form (basic protection)
            recruitmentForm.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });

            // Security: Disable copy/paste on sensitive fields
            const sensitiveFields = ['regNumber', 'phone'];
            sensitiveFields.forEach(fieldName => {
                const field = document.getElementById(fieldName);
                if (field) {
                    field.addEventListener('paste', function(e) {
                        e.preventDefault();
                    });
                }
            });
        });
    </script>
    
    <!-- Tilted Card Effect -->
    <script src="tilted-card.js"></script>
    <script src="scroll-restriction.js"></script>
</body>
</html>